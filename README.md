VISTA
=====
USE VENTASCIB

SELECT DF.NUM_FAC,P.COD_PRO,P.DES_PRO
   FROM TB_DETALLE_FACTURA DF INNER JOIN TB_PRODUCTO P
   ON DF.COD_PRO=P.COD_PRO

   SELECT NUM_FAC,COUNT(COD_PRO) AS CAN_PRO
   FROM TB_DETALLE_FACTURA
   GROUP BY NUM_FAC

   ------- REALICE UNA CONSULTA QUE LISTE EL COD_PRO DES_PRO Y LA SUMA TOTAL VENDIDA DE DICHO PRODUCTO
   

   CREATE VIEW V_TOTALPRODUCTO
   AS
   SELECT P.COD_PRO, P.DES_PRO,SUM (CAN_VEN) AS TOTAL_VEN
     FROM TB_PRODUCTO P INNER JOIN TB_DETALLE_FACTURA DF
	 ON P.COD_PRO=DF.COD_PRO 
	 GROUP BY P.COD_PRO,P.DES_PRO HAVING SUM (CAN_VEN)>100

	 SELECT * FROM V_TOTALPRODUCTO WHERE TOTAL_VEN>100



	------- REALICE UNA CONSULTA QUE LISTE COD_VEN NOM_VEN APE_VEN Y CANTIDAD DE CLIENTES A LOS CUALES HA FACTURADO

	 CREATE VIEW V_TOTALCLIENTE_VEN
	 AS
	 SELECT V.COD_VEN, V.NOM_VEN, V.APE_VEN ,COUNT(COD_CLI) AS CANT_CLI
	 FROM TB_VENDEDOR V INNER JOIN TB_FACTURA F
	 ON V.COD_VEN=F.COD_VEN
	 GROUP BY V.COD_VEN, V.NOM_VEN, V.APE_VEN

	 SELECT * FROM V_TOTALCLIENTE_VEN

	 ----- ELABORE UNA CONSULTA UQE MUESTRE EL PRECIO PROMEDIO DE COMPRA DE CADA PRODUCTO (LISTAR COD_PRO,DES_PRO Y PRECIO PROMEDIO DE COMPRA)

	 SELECT P.COD_PRO, P.DES_PRO,AVG (PRE_ABA) AS PRE_PROM_COMP
	 FROM TB_PRODUCTO P INNER JOIN TB_ABASTECIMIENTO A
	 ON P.COD_PRO=A.COD_PRO
	 GROUP BY P.COD_PRO,P.DES_PRO

	 ----- CRAR UN PROCEDIMIENTO  ALMACENADO QUE PERMITA ELIMINAR LOS CLIENTES QUE NO HAN TENIDO FACTURACION


	 SELECT * 

	 FROM TB_CLIENTE
	 WHERE COD_CLI NOT IN (SELECT COD_CLI FROM TB_FACTURA)

	  FROM TB_CLIENTE
	 WHERE COD_CLI NOT IN (SELECT COD_CLI FROM TB_FACTURA)

	 CREATE PROCEDURE SP_ELIMINAR_CLIENTE
	 AS
	 BEGIN
	 DELETE FROM TB_CLIENTE
	 WHERE COD_CLI NOT IN (SELECT COD_CLI FROM TB_FACTURA)
	 END

	 EXEC SP_ELIMINAR_CLIENTE

	 ----ELABORE UN PROCEDIMIENTO ALMACENADO QUE LISTE COD_PRO,DES_PRO,PRE_PRO QUE SEA VENDIDO POR UN DETERMINADO PROVEEDOR CUYO CODIGO SERA INGRESADO
	  ----POR UN PARAMETRO EN EL PROCEDIMIENTO ALMACENADO


	  SELECT COD_PRO,DES_PRO,PRE_PRO
	  FROM TB_PRODUCTO P INNER JOIN TB_ABASTECIMIENTO A
	  ON P.COD_PRO=A.COD_PRO
	                     INNER JOIN TB_PRODUCTO TB_PROV PV
	  ON A.COD_PRV=PV.COD_PRV


	  WHERE COD_PRV='PR002'

	  CREATE PROCEDURE SP_PRODUCTO_PROVEEDOR
	  @CODPRV  CHAR(5)
	  AS
	  BEGIN
	  SELECT COD_PRO,DES_PRO,PRE_PRO 
	     FROM TB_PRODUCTO
		 WHERE COD_PRO IN (SELECT COD_PRO FROM TB_ABASTECIMIENTO
		                    WHERE COD_PRV=@CODPRV)
